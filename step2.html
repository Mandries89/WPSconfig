<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Configuration Form - Step 2</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <div class="info-box">In te vullen door de klant</div>
                <div class="info-box">In te vullen door WPS</div>
            </div>
            <div class="header-center">
                <img src="logo.png" alt="WPS Logo" class="logo">
            </div>
            <div class="header-right"></div>
        </header>

        <form id="step2Form" name="configFormStep2" method="POST" data-netlify="true" onsubmit="handleSubmit(event)">
            <input type="hidden" name="form-name" value="configFormStep2">
            
            <!-- Hidden inputs to retain data from step 1 -->
            <input type="hidden" name="projectName" value="">
            <input type="hidden" name="address" value="">
            <input type="hidden" name="street" value="">
            <input type="hidden" name="postalCode" value="">
            <input type="hidden" name="city" value="">
            <input type="hidden" name="country" value="">
            <input type="hidden" name="customerProjectLeader" value="">
            <input type="hidden" name="email" value="">
            <input type="hidden" name="phone" value="">
            <input type="hidden" name="wpsProjectLeader" value="">
            <input type="hidden" name="wpsSalesManager" value="">
            <input type="hidden" name="installationDate" value="">

            <div class="form-container">
                <!-- Vraag naar aantal secties -->
                <div class="form-group">
                    <label for="numSections">Number of sections</label>
                    <input type="number" id="numSections" name="numSections" min="1" required>
                    <button type="button" onclick="generateSections()">Generate Sections</button>
                </div>

                <!-- Placeholder voor secties -->
                <div id="sectionsContainer"></div>
            </div>

            <!-- Sums -->
            <h2>Summary</h2>
            <table id="summaryTable">
                <tr>
                    <th>Total</th>
                    <th>Entry</th>
                    <th>Exit</th>
                    <th>POF</th>
                    <th>DOOR</th>
                    <th>GATE</th>
                    <th>Cashless</th>
                    <th>SCANNER</th>
                    <th>Counters</th>
                </tr>
                <tr>
                    <td id="totalSpaces">0</td>
                    <td id="totalEntry">0</td>
                    <td id="totalExit">0</td>
                    <td id="totalPOF">0</td>
                    <td id="totalDOOR">0</td>
                    <td id="totalGATE">0</td>
                    <td id="totalCashless">0</td>
                    <td id="totalSCANNER">0</td>
                    <td id="totalCounters">0</td>
                </tr>
            </table>

            <input type="submit" value="Next">
        </form>
        <button class="back-button" onclick="goBack()">Back</button>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('input[type="hidden"]').forEach(input => {
                input.value = sessionStorage.getItem(input.name);
            });
        });

        function generateSections() {
            const numSections = document.getElementById('numSections').value;
            const sectionsContainer = document.getElementById('sectionsContainer');
            sectionsContainer.innerHTML = '';  // Clear previous sections

            const table = document.createElement('table');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th>Parking Sections</th>
                <th>Name</th>
                <th>Spaces</th>
                <th>Entry</th>
                <th>Exit</th>
                <th>POF</th>
                <th>DOOR</th>
                <th>GATE</th>
                <th>Cashless</th>
                <th>SCANNER</th>
                <th>C-display</th>
                <th>Remark</th>
            `;
            table.appendChild(headerRow);

            for (let i = 1; i <= numSections; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>Section ${i}</td>
                    <td><input type="text" name="section${i}Name" value="in te vullen indien meerdere secties" required></td>
                    <td><input type="number" name="section${i}Spaces" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}Entry" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}Exit" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}POF" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}DOOR" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}GATE" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}Cashless" required oninput="calculateSums()"></td>
                    <td><input type="number" name="section${i}SCANNER" required oninput="calculateSums()"></td>
                    <td>
                        <select name="section${i}Cdisplay" onchange="calculateSums()">
                            <option value="Yes">Yes</option>
                            <option value="No" selected>No</option>
                        </select>
                    </td>
                    <td><input type="text" name="section${i}Remark"></td>
                `;
                table.appendChild(row);
            }

            sectionsContainer.appendChild(table);
            calculateSums();
        }

        function calculateSums() {
            const numSections = document.getElementById('numSections').value;
            let totalSpaces = 0;
            let totalEntry = 0;
            let totalExit = 0;
            let totalPOF = 0;
            let totalDOOR = 0;
            let totalGATE = 0;
            let totalCashless = 0;
            let totalSCANNER = 0;
            let totalCounters = 0;

            for (let i = 1; i <= numSections; i++) {
                const spaces = parseInt(document.querySelector(`input[name="section${i}Spaces"]`)?.value || 0);
                const entry = parseInt(document.querySelector(`input[name="section${i}Entry"]`)?.value || 0);
                const exit = parseInt(document.querySelector(`input[name="section${i}Exit"]`)?.value || 0);
                const pof = parseInt(document.querySelector(`input[name="section${i}POF"]`)?.value || 0);
                const door = parseInt(document.querySelector(`input[name="section${i}DOOR"]`)?.value || 0);
                const gate = parseInt(document.querySelector(`input[name="section${i}GATE"]`)?.value || 0);
                const cashless = parseInt(document.querySelector(`input[name="section${i}Cashless"]`)?.value || 0);
                const scanner = parseInt(document.querySelector(`input[name="section${i}SCANNER"]`)?.value || 0);
                const cdisplay = document.querySelector(`select[name="section${i}Cdisplay"]`)?.value || 'No';

                totalSpaces += spaces;
                totalEntry += entry;
                totalExit += exit;
                totalPOF += pof;
                totalDOOR += door;
                totalGATE += gate;
                totalCashless += cashless;
                totalSCANNER += scanner;
                if (cdisplay === 'Yes') {
                    totalCounters++;
                }
            }

            document.getElementById('totalSpaces').innerText = totalSpaces;
            document.getElementById('totalEntry').innerText = totalEntry;
            document.getElementById('totalExit').innerText = totalExit;
            document.getElementById('totalPOF').innerText = totalPOF;
            document.getElementById('totalDOOR').innerText = totalDOOR;
            document.getElementById('totalGATE').innerText = totalGATE;
            document.getElementById('totalCashless').innerText = totalCashless;
            document.getElementById('totalSCANNER').innerText = totalSCANNER;
            document.getElementById('totalCounters').innerText = totalCounters;

            // Save sums to sessionStorage for use on page 3
            sessionStorage.setItem('totalSpaces', totalSpaces);
            sessionStorage.setItem('totalEntry', totalEntry);
            sessionStorage.setItem('totalExit', totalExit);
            sessionStorage.setItem('totalPOF', totalPOF);
            sessionStorage.setItem('totalDOOR', totalDOOR);
            sessionStorage.setItem('totalGATE', totalGATE);
            sessionStorage.setItem('totalCashless', totalCashless);
            sessionStorage.setItem('totalSCANNER', totalSCANNER);
            sessionStorage.setItem('totalCounters', totalCounters);
        }

        function handleSubmit(event) {
            event.preventDefault();
            // Process and submit the form data
            const formData = new FormData(event.target);
            for (let [key, value] of formData.entries()) {
                sessionStorage.setItem(key, value);
            }
            // Redirect to the next page
            window.location.href = "step3.html";
        }

        function goBack() {
            window.location.href = "index.html";
        }
    </script>
</body>
</html>
